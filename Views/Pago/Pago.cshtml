<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pago</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Estilos personalizados -->
    <link rel="stylesheet" href="~/css/Pago.css">
</head>
<body>
    <div class="container mt-4 mb-5">
        

        <!-- Indicador de progreso -->
        <div class="progress-container mb-5">
            <div class="progress-bar-container">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
            
            <div class="step-container">
                <div class="step completed" id="step-1">
                    <div class="step-icon">
                        <i class="fas fa-shopping-cart"></i>
                    </div>
                    <div class="step-text">Carro</div>
                </div>
                
                <div class="step completed" id="step-2">
                    <div class="step-icon">
                        <i class="fas fa-map-marker-alt"></i>
                    </div>
                    <div class="step-text">Información de envío</div>
                </div>
                
                <div class="step completed" id="step-3">
                    <div class="step-icon">
                        <i class="fas fa-truck"></i>
                    </div>
                    <div class="step-text">Entrega</div>
                </div>
                
                <div class="step active" id="step-4">
                    <div class="step-icon">
                        <i class="fas fa-credit-card"></i>
                    </div>
                    <div class="step-text">Pago</div>
                </div>
            </div>
        </div>

        <!-- Contenido principal -->
        <div class="main-content">
            <div class="row">
                <div class="col-md-8">
                    <div class="card mb-4">
                        <div class="card-body">
                            <h4 class="mb-4">Información de pago</h4>
                            <form id="payment-form">
                                <div class="mb-3">
                                    <label for="cardNumber" class="form-label">Número de tarjeta *</label>
                                    <input type="text" class="form-control" id="cardNumber" placeholder="4000 1234 5678 9010" required>
                                    <div class="invalid-feedback">
                                        Por favor ingresa un número de tarjeta válido.
                                    </div>
                                </div>
                                
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label class="form-label">Fecha Vencimiento *</label>
                                        <div class="d-flex">
                                            <select class="form-select me-2" id="expiryMonth" required>
                                                <option value="">-Mes-</option>
                                                <option value="01">01</option>
                                                <option value="02">02</option>
                                                <option value="03">03</option>
                                                <option value="04">04</option>
                                                <option value="05">05</option>
                                                <option value="06">06</option>
                                                <option value="07">07</option>
                                                <option value="08">08</option>
                                                <option value="09">09</option>
                                                <option value="10">10</option>
                                                <option value="11">11</option>
                                                <option value="12">12</option>
                                            </select>
                                            <span class="d-flex align-items-center px-2">/</span>
                                            <select class="form-select" id="expiryYear" required>
                                                <option value="">-Año-</option>
                                                <option value="2023">2023</option>
                                                <option value="2024">2024</option>
                                                <option value="2025">2025</option>
                                                <option value="2026">2026</option>
                                                <option value="2027">2027</option>
                                                <option value="2028">2028</option>
                                            </select>
                                        </div>
                                        <div class="invalid-feedback">
                                            Por favor selecciona la fecha de vencimiento.
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="cvv" class="form-label">Código de seguridad *</label>
                                        <div class="d-flex">
                                            <input type="text" class="form-control" id="cvv" placeholder="000" required>
                                            <span class="ms-2 d-flex align-items-center text-primary">CVV/CVC <i class="fas fa-info-circle ms-1"></i></span>
                                        </div>
                                        <div class="invalid-feedback">
                                            Por favor ingresa el código de seguridad.
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="installments" class="form-label">Cuotas *</label>
                                    <select class="form-select" id="installments" required>
                                        <option value="1" selected>Sin cuotas</option>
                                        <option value="3">3 cuotas</option>
                                        <option value="6">6 cuotas</option>
                                        <option value="12">12 cuotas</option>
                                    </select>
                                    <div class="invalid-feedback">
                                        Por favor selecciona las cuotas.
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="cardholderName" class="form-label">Nombre en la tarjeta *</label>
                                    <input type="text" class="form-control" id="cardholderName" placeholder="Nombre Completo" required>
                                    <div class="invalid-feedback">
                                        Por favor ingresa el nombre del titular de la tarjeta.
                                    </div>
                                </div>
                                
                                <div class="row mb-3">
                                    <div class="col-md-4">
                                        <label for="documentType" class="form-label">Documento de identificación *</label>
                                        <select class="form-select" id="documentType" required>
                                            <option value="DNI" selected>DNI</option>
                                            <option value="CE">CE</option>
                                            <option value="Pasaporte">Pasaporte</option>
                                        </select>
                                    </div>
                                    <div class="col-md-8">
                                        <label for="documentNumber" class="form-label">&nbsp;</label>
                                        <input type="text" class="form-control" id="documentNumber" required>
                                        <div class="invalid-feedback">
                                            Por favor ingresa el número de documento.
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="phone" class="form-label">Teléfono Celular *</label>
                                    <div class="input-group">
                                        <span class="input-group-text">
                                            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/cf/Flag_of_Peru.svg/20px-Flag_of_Peru.svg.png" alt="Perú" class="me-1" style="height: 12px;">
                                            +51
                                        </span>
                                        <input type="text" class="form-control" id="phone" placeholder="Ej: 976543210" required>
                                    </div>
                                    <div class="invalid-feedback">
                                        Por favor ingresa un número de teléfono válido.
                                    </div>
                                </div>
                                
                                <div class="mb-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="termsCheck" required>
                                        <label class="form-check-label" for="termsCheck">
                                            Acepto los <a href="#" class="text-success">términos y condiciones</a> generales de uso para pagadores PayU y autorizo el <a href="#" class="text-success">tratamiento de datos personales</a>
                                        </label>
                                        <div class="invalid-feedback">
                                            Debes aceptar los términos y condiciones.
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="d-grid">
                                    <button type="submit" class="btn btn-success btn-lg" id="pay-button">
                                        Pagar <i class="fas fa-arrow-right"></i>
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="mb-3">Resumen de la compra</h5>
                            <div class="d-flex justify-content-between mb-2">
                                <span>Productos (3)</span>
                                <span class="fw-bold">S/ 2,397</span>
                            </div>
                            <div class="d-flex justify-content-between mb-2">
                                <span>Descuentos (1)</span>
                                <span class="fw-bold text-danger">- S/ 600</span>
                            </div>
                            <div class="d-flex justify-content-between mb-3">
                                <span>Entregas (1)</span>
                                <span class="fw-bold">S/ 12.90</span>
                            </div>
                            <hr>
                            <div class="d-flex justify-content-between mb-2">
                                <span class="fw-bold">Total:</span>
                                <span class="fw-bold">S/ 1,809.90</span>
                            </div>
                            <div class="d-flex justify-content-between align-items-center">
                                <span>Total con Falabella:</span>
                                <div>
                                    <img src="https://via.placeholder.com/60x20" alt="Medios de pago" class="me-2">
                                    <span class="fw-bold text-danger">S/ 1,659.90</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de confirmación -->
    <div class="confirmation-modal" id="confirmation-modal">
        <div class="confirmation-content">
            <div class="thumbs-up">
                <i class="fas fa-thumbs-up"></i>
            </div>
            <h3 class="mb-3">¡Pago hecho!</h3>
            <p class="mb-4">Gracias por su compra</p>
            <a href="index.html" class="btn btn-primary">Volver a la tienda</a>
        </div>
    </div>
<a asp-controller="Pago" asp-action="confirmacion">siguiente</a>
    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- JavaScript personalizado -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar si hay datos necesarios
            const addressData = localStorage.getItem('addressData');
            const deliveryOption = localStorage.getItem('deliveryOption');
            const selectedDeliveryOption = localStorage.getItem('selectedDeliveryOption');
            
            
            
            // Formulario de pago
            const paymentForm = document.getElementById('payment-form');
            const confirmationModal = document.getElementById('confirmation-modal');
            
            // Validar formulario de pago
            function validatePaymentForm() {
                const cardNumber = document.getElementById('cardNumber');
                const expiryMonth = document.getElementById('expiryMonth');
                const expiryYear = document.getElementById('expiryYear');
                const cvv = document.getElementById('cvv');
                const cardholderName = document.getElementById('cardholderName');
                const documentNumber = document.getElementById('documentNumber');
                const phone = document.getElementById('phone');
                const termsCheck = document.getElementById('termsCheck');
                
                let isValid = true;
                
                if (!cardNumber.value || !/^\d{16}$/.test(cardNumber.value.replace(/\s/g, ''))) {
                    cardNumber.classList.add('is-invalid');
                    isValid = false;
                } else {
                    cardNumber.classList.remove('is-invalid');
                }
                
                if (!expiryMonth.value) {
                    expiryMonth.classList.add('is-invalid');
                    isValid = false;
                } else {
                    expiryMonth.classList.remove('is-invalid');
                }
                
                if (!expiryYear.value) {
                    expiryYear.classList.add('is-invalid');
                    isValid = false;
                } else {
                    expiryYear.classList.remove('is-invalid');
                }
                
                if (!cvv.value || !/^\d{3,4}$/.test(cvv.value)) {
                    cvv.classList.add('is-invalid');
                    isValid = false;
                } else {
                    cvv.classList.remove('is-invalid');
                }
                
                if (!cardholderName.value) {
                    cardholderName.classList.add('is-invalid');
                    isValid = false;
                } else {
                    cardholderName.classList.remove('is-invalid');
                }
                
                if (!documentNumber.value) {
                    documentNumber.classList.add('is-invalid');
                    isValid = false;
                } else {
                    documentNumber.classList.remove('is-invalid');
                }
                
                if (!phone.value || !/^\d{9}$/.test(phone.value)) {
                    phone.classList.add('is-invalid');
                    isValid = false;
                } else {
                    phone.classList.remove('is-invalid');
                }
                
                if (!termsCheck.checked) {
                    termsCheck.classList.add('is-invalid');
                    isValid = false;
                } else {
                    termsCheck.classList.remove('is-invalid');
                }
                
                return isValid;
            }
            
            // Pagar
            paymentForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                if (validatePaymentForm()) {
                    // Mostrar modal de confirmación
                    confirmationModal.classList.add('show');
                }
            });
            
            // Formatear número de tarjeta
            const cardNumberInput = document.getElementById('cardNumber');
            cardNumberInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.length > 16) {
                    value = value.slice(0, 16);
                }
                
                // Formatear con espacios cada 4 dígitos
                const formattedValue = value.replace(/(\d{4})(?=\d)/g, '$1 ');
                e.target.value = formattedValue;
            });
            
            // Formatear CVV
            const cvvInput = document.getElementById('cvv');
            cvvInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.length > 4) {
                    value = value.slice(0, 4);
                }
                e.target.value = value;
            });
            
            // Formatear teléfono
            const phoneInput = document.getElementById('phone');
            phoneInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.length > 9) {
                    value = value.slice(0, 9);
                }
                e.target.value = value;
            });
        });
    </script>
</body>
</html>